<!DOCTYPE html>
<html lang="es">
<head>
{% include 'macros/head.html' %}
<link rel="stylesheet" href="{{ url_for('static', filename='rd_styles.css') }}">
</head>
<body>
    <div class="container">
        {% include 'macros/encabezado.html' %}

        <form method="get" action="{{ url_for('resumen_diario') }}" class="filtro-fecha-resumen">
            <button type="button" onclick="cambiarFecha(-1)" class="fecha-btn">&larr;</button>

            <input type="date" id="fechaResumen" name="fecha" value="{{ fecha_actual }}">

            <button type="submit" class="filtro-btn filtro-submit" title="Aplicar filtro">
                <svg viewBox="0 0 20 20" fill="currentColor" class="filtro-svg">
                    <path fill-rule="evenodd"
                        d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"
                        clip-rule="evenodd" />
                </svg><!-- ícono del filtro -->
            </button>

            <button type="button" onclick="cambiarFecha(1)" class="fecha-btn">&rarr;</button>
            
        </form>
                
        {% include 'macros/disclaimer.html' %}
        <!-- FORMULARIO FUNCIONAL -->


        <div class="aviso">
            <div class="encabezado-resumen">
                <div class="titulo-resumen">
                    <h2>Resumen del día</h2>
                </div>

                <div class="fecha-resumen">
                    {% if fecha_actualizacion and fecha_actualizacion|trim  %}
                    Generado el <span class="dd-mm-yyyy" data-utc="{{ fecha_actualizacion }}">Cargando...</span>
                    (Modelo IA utilizado: {{ modelo }})
                    {% else %}
                    Fijate otro día porque el <span class="dd-mm-yyyy" data-utc="{{ request.args.get('fecha') }}">Cargando...</span> no tiene info.                   
                    {% endif %}
                </div>
            </div>

            <div class="TextoResumido">
              
                    {{ resumen_diario | safe }}
                

                <!-- Botones compartir -->
                <div class="share-buttons-resumen">
                    <a href="https://api.whatsapp.com/send?text=Resumen%20del%20d%C3%ADa%20{{ fecha_actual }}%0A%0A{{ resumen_diario | truncate(100) | urlencode }}%0A%0A{{ url_for('resumen_diario', fecha=fecha_actual, _external=True) | urlencode }}"
                        class="share-btn whatsapp" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-whatsapp"></i>Whatsapp
                    </a>
                    <a href="https://t.me/share/url?text=Resumen%20del%20d%C3%ADa%20{{ fecha_actual }}%0A%0A{{ resumen_diario | truncate(100) | urlencode }}%0A%0A{{ url_for('resumen_diario', fecha=fecha_actual, _external=True) | urlencode }}"
                        class="share-btn telegram" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-telegram"></i>Telegram
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ url_for('resumen_diario', fecha=fecha_actual, _external=True) | urlencode }}&title=Resumen%20del%20d%C3%ADa%20{{ fecha_actual }}&description={{ resumen_diario | truncate(200) | urlencode }}"
                        class="share-btn facebook" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-facebook"></i>Facebook
                    </a>
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ url_for('resumen_diario', fecha=fecha_actual, _external=True) | urlencode }}&title=Resumen%20del%20d%C3%ADa%20{{ fecha_actual }}&summary={{ resumen_diario | truncate(200) | urlencode }}&source=BoletínNOOficial"
                        class="share-btn linkedin" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-linkedin"></i>LinkedIn
                    </a>
                    <a href="https://X.com/intent/tweet?text=Resumen%20del%20d%C3%ADa%20{{ fecha_actual }}%0A%0A{{ resumen_diario | truncate(100) | urlencode }}%0A%0A{{ url_for('resumen_diario', fecha=fecha_actual, _external=True) | urlencode }}"
                        class="share-btn X" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-twitter"></i>X
                    </a>
                </div>
            </div>
        </div>



        {% include 'macros/arriba.html' %}
                
        {% include 'macros/donar.html' %}

        <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
        <script>
            function cambiarFecha(dias) {
                const inputFecha = document.getElementById('fechaResumen');
                const fecha = new Date(inputFecha.value);
                fecha.setDate(fecha.getDate() + dias);
                inputFecha.value = fecha.toISOString().split('T')[0];
                inputFecha.form.submit();
            }

            document.addEventListener('DOMContentLoaded', function () {
                const urlParams = new URLSearchParams(window.location.search);
                if (!urlParams.has('fecha')) {
                    document.getElementById('fechaResumen').valueAsDate = new Date();
                }
            });
        </script>
    </div>
</body>

</html>